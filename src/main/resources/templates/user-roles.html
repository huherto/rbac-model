<div class="row">
    <div class="col-lg-12">
        <h1 class="page-header">User Roles</h1>
        <h3>List roles for {{user.firstName}} {{user.lastName}}</h3>
      <div class="panel panel-default">
        <div class="panel-heading">
          Roles
        </div>
        <div class="panel-body">
          <div class="row">
            <button type="button" class="btn btn-primary pull-right" style="margin-right: 15px; margin-bottom: 15px" id="new-role-button">Add New Role</button>
          </div>
          <table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-user-roles">
            <thead>
              <tr>
                <th>Realm</th>
                <th>Role Id</th>
                <th>Role Name</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              {{#userRoles}}
              <tr>
                <td>{{realm}}</td>
                <td>{{roleId}}</td>
                <td>{{roleName}}</td>
                <td><button type="button" class="btn btn-primary delete-role" id="{{userRoleRealmId}}">Delete</button></td>
              </tr>
              {{/userRoles}}
            </tbody>
          </table>
        </div>
      </div>
    </div>
</div>

<form method="post" action="delete-user-role.html" id="deleteRoleForm">
  <input type="hidden" name="userRoleRealmId" id="userRoleRealmId" value="123"/>
</form>

<form method="post" action="new-user-role.html" id="newRoleForm">
  <input type="hidden" name="userId" id="userId" value="{{user.userId}}"/>
  <input type="hidden" name="realmField" id="realmField" value=""/>
  <input type="hidden" name="roleField" id="roleField" value="" />  
</form>

<script>

$(".delete-role").click(function()  {

  $("#userRoleRealmId").val(this.id);

  bootbox.confirm({
      message: "Please confirm role deletion",
      buttons: {
          confirm: {
              label: 'Yes',
              className: 'btn-success'
          },
          cancel: {
              label: 'No',
              className: 'btn-danger'
          }
      },
      callback: function (result) {
          console.log('This was logged in the callback: ' + result);
          if (result) {

            $.post("user/"+result)

            $("#deleteRoleForm").submit();            
          }
      }
  });  

});


$("#new-role-button").click(function () {

  bootbox.prompt({
    title: "Select new role",
    inputType: 'select',
    inputOptions: [
        {
            text: 'Choose one...',
            value: '',
        },
        {{#allroles}}
        {
            text: '{{roleName}}',
            value: '{{roleId}}',
        },
        {{/allroles}}
    ],
    callback: function (result) {
        console.log("selected:"+result);
        if (result !== '') {
            $("#realmField").val("GLOBAL");            
            $("#roleId").val(result);
            $("#newRoleForm").submit();            
        }
    }
  });

});

$(document).ready(function() {
    $('#dataTables-user-roles').DataTable({
        responsive: true,
        "iDisplayLength": 50,
        "paging": false,
    });
});

</script>
